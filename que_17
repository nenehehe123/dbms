-- Step 1: Create assessment table
CREATE TABLE assessment (
    reg_no INT PRIMARY KEY,
    name VARCHAR(100),
    mark1 INT,
    mark2 INT,
    mark3 INT,
    total INT
);

-- Step 2: Create dept_details table
CREATE TABLE dept_details (
    dept_no INT PRIMARY KEY,
    dept_name VARCHAR(100),
    location VARCHAR(100)
);

-- Step 3: Function to print grade based on a mark
CREATE OR REPLACE FUNCTION PrintGrade(mark INT)
RETURNS TEXT
LANGUAGE plpgsql
AS $$
BEGIN
    IF mark BETWEEN 91 AND 100 THEN
        RETURN 'Grade A';
    ELSIF mark BETWEEN 81 AND 90 THEN
        RETURN 'Grade B';
    ELSIF mark BETWEEN 71 AND 80 THEN
        RETURN 'Grade C';
    ELSIF mark BETWEEN 60 AND 70 THEN
        RETURN 'Grade D';
    ELSE
        RETURN 'Grade E';
    END IF;
END;
$$;

-- Example usage:
-- SELECT PrintGrade(85);

-- Step 4: Trigger to check for nulls before insert in assessment table
CREATE OR REPLACE FUNCTION validate_assessment_data()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
    IF NEW.name IS NULL OR NEW.mark1 IS NULL OR NEW.mark2 IS NULL OR NEW.mark3 IS NULL THEN
        RAISE EXCEPTION 'Null values are not allowed in name or marks.';
    END IF;
    RETURN NEW;
END;
$$;

CREATE TRIGGER check_nulls_before_insert
BEFORE INSERT ON assessment
FOR EACH ROW
EXECUTE FUNCTION validate_assessment_data();

-- Step 5: Insert example data (this will succeed)
INSERT INTO assessment (reg_no, name, mark1, mark2, mark3, total)
VALUES (1, 'Arun', 85, 90, 88, 263);

-- This one would raise an exception due to null
-- INSERT INTO assessment (reg_no, name, mark1, mark2, mark3, total)
-- VALUES (2, NULL, 70, 80, 90, 240);
